import"./modulepreload-polyfill-B5Qt9EMX.js";import{i as M,a as S,g as P,o as T,u as I}from"./auth-gate-B8HnkSQA.js";import{a as x,g as h,s as C,t as f,c as D}from"./responsive-DwadFwRg.js";import{i as O,a as U,s as q}from"./confirmModal-L4nKbxRN.js";M({loginPath:"/login"});async function L(r){try{const s=document.getElementById("profileMsg");s?(s.textContent=r,s.classList.remove("hidden")):alert(r)}catch{console.error(r)}}async function $(){try{const r=document.getElementById("profileMsg");r&&(r.textContent="",r.classList.add("hidden"))}catch{}}function v(r,s){if(!r)return;r.setAttribute("data-state",s?"checked":"unchecked"),r.setAttribute("aria-checked",s?"true":"false"),r.style.background=s?"linear-gradient(90deg, rgba(168,85,247,0.95), rgba(217,70,239,0.95))":"rgba(51,65,85,0.55)",r.style.boxShadow=s?"0 0 0 1px rgba(168,85,247,0.45), 0 0 12px rgba(168,85,247,0.25)":"0 0 0 1px rgba(148,163,184,0.25)";const u=r.querySelector("span");u&&(s?u.classList.add("translate-x-5"):u.classList.remove("translate-x-5"))}function B(r){if(!r)return;const s=r.value,u=f(),y=["es","en","zh","pt"];r.innerHTML="",y.forEach(g=>{const c=document.createElement("option");c.value=g,c.textContent=u.languages[g],c.setAttribute("data-i18n",`languages.${g}`),r.appendChild(c)}),y.includes(s)?r.value=s:r.value=h(),r.blur()}async function j(){O(),x();const r=document.getElementById("name"),s=document.getElementById("email"),u=document.getElementById("avatarImg"),y=document.getElementById("changePhotoBtn"),g=document.getElementById("avatarInput"),c=document.getElementById("saveProfileBtn"),m=document.getElementById("dark-mode"),E=document.getElementById("task-reminders"),b=document.getElementById("habit-reminders"),k=document.getElementById("progress-updates"),l=document.getElementById("language-select"),_=document.getElementById("logoutBtn");if(!r||!s||!u||!y||!g||!c){console.error("Profile page: missing DOM elements");return}_&&_.addEventListener("click",async a=>{a.preventDefault();try{await S(),window.location.href="/"}catch(t){console.error("Error al cerrar sesiÃ³n:",t),window.location.href="/"}});let p=null;try{const a=await P();p=a;const t=a.language||a.preferences?.language;t&&t!==h()&&(C(t),x()),l&&(B(l),t&&(l.value=t)),r.value=a.first_name||a.username||"",s.value=a.email||"";const n=a.avatar||a.photo||a.avatar_url||a.profile_image;n&&(u.src=n);const e=a.preferences||{};try{if(m&&e.dark_mode){m.setAttribute("data-state","checked"),m.setAttribute("aria-checked","true");const A=m.querySelector("span");A&&A.classList.add("translate-x-5")}const i=e.task_reminders!==!1,o=e.habit_reminders!==!1,d=e.progress_updates!==!1;v(E,i),v(b,o),v(k,d);const w=e.language||h();l&&(l.value=w,B(l))}catch{}}catch(a){console.error("Error loading user",a);const t=f();await L(t.profile.loadUserError)}y.addEventListener("click",()=>g.click()),g.addEventListener("change",async a=>{const t=g.files;if(!t||t.length===0)return;const n=t[0];c.disabled=!0;try{const e=await T(n),i=e?.avatar||e?.url||e?.avatar_url||e?.photo||e?.profile_image;i&&u&&(u.src=i),await $();const o=f(),d=document.getElementById("profileMsg");d&&(d.textContent=o.profile.avatarUpdated,d.classList.remove("hidden"),setTimeout(()=>{d&&(d.classList.add("hidden"),d.textContent="")},3e3))}catch(e){console.error("Upload avatar error",e);let o=f().profile.avatarUpdateError;try{e instanceof Error?o=e.message||o:o=String(e)}catch{}try{e&&typeof e=="object"&&"status"in e&&(o=`Error ${e.status}`)}catch{}await L(o)}finally{c.disabled=!1}}),c.addEventListener("click",async a=>{a.preventDefault(),c.disabled=!0;const t={};r.value&&(t.first_name=r.value),s.value&&(t.email=s.value),t.language=h();const n={};m&&(n.dark_mode=m.getAttribute("data-state")==="checked"),E&&(n.task_reminders=E.getAttribute("data-state")==="checked"),b&&(n.habit_reminders=b.getAttribute("data-state")==="checked"),k&&(n.progress_updates=k.getAttribute("data-state")==="checked"),n.language=h(),Object.keys(n).length&&(t.preferences=n);try{await I(t);const e=f();await U(e.profile.profileUpdated,e.common.success)}catch(e){console.error("Error updating profile",e);const i=f();await L(i.profile.profileUpdateError)}finally{c.disabled=!1}}),document.querySelectorAll('[role="switch"]').forEach(a=>{a.addEventListener("click",t=>{const n=t.currentTarget,e=n.getAttribute("data-state")==="checked";v(n,!e)})}),[{el:E,key:"task_reminders"},{el:b,key:"habit_reminders"},{el:k,key:"progress_updates"}].forEach(({el:a,key:t})=>{a&&a.addEventListener("click",async()=>{const n=a.getAttribute("data-state")==="checked",e=!n;a.style.pointerEvents="none";try{const o={...p?.preferences||{},[t]:n};await I({preferences:o}),p={...p||{},preferences:o}}catch(i){console.error(`Error saving ${t}:`,i),v(a,e);const o=f();await L(o.profile.profileUpdateError)}finally{a.style.pointerEvents=""}})}),l&&(l.addEventListener("change",async a=>{const t=a.target.value,n=h();if(t===n)return;const e=f();if(!await q(e.confirmations.changeLanguageMessage,e.confirmations.changeLanguage)){l.value=n;return}C(t),x(),B(l);try{const w={...p?.preferences||{},language:t};await I({preferences:w,language:t}),p={...p,preferences:w,language:t}}catch(d){console.error("Error saving language preference:",d)}const o=D(t);await U(o.profile.languageChangeSuccess,o.profile.languageChanged),window.location.reload()}),B(l))}document.addEventListener("DOMContentLoaded",j);
