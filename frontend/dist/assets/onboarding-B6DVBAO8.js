import{g as v,b as _,u as g}from"./auth-gate-CYQPWai6.js";import{s as P,a as B,g as I}from"./responsive-BEQ_P_Nu.js";const C="studyo_onboarding_context",c="studyo_onboarding_started",w="studyo_onboarding_event_once_",O="studyo_onboarding_lang_auto_";function b(t,e,o){const a=o?`${o}_`:"",n=`${w}${a}${t}`;localStorage.getItem(n)!=="1"&&(e(),localStorage.setItem(n,"1"))}function l(t,e){const o={event:t,...e,ts:Date.now()};try{document.dispatchEvent(new CustomEvent("analytics:event",{detail:o}))}catch{}try{document.dispatchEvent(new CustomEvent("onboarding:event",{detail:o}))}catch{}}function d(t){localStorage.setItem(C,JSON.stringify(t))}function H(){try{const t=localStorage.getItem(C);return t?JSON.parse(t):null}catch{return null}}function y(){return{overlay:document.getElementById("onboardingOverlay"),titleEl:document.getElementById("onboardingTitle"),bodyEl:document.getElementById("onboardingBody"),primaryBtn:document.getElementById("onboardingPrimaryBtn"),closeBtn:document.getElementById("onboardingCloseBtn"),skipBtn:document.getElementById("onboardingSkipBtn")}}function f(t){let e=document.getElementById("onboardingToast");e||(e=document.createElement("div"),e.id="onboardingToast",e.className="onboarding-toast",document.body.appendChild(e)),e.textContent=t,e.classList.remove("show"),requestAnimationFrame(()=>e.classList.add("show")),setTimeout(()=>e?.classList.remove("show"),1400)}async function h(t,e){const o=s();if(!o||!o.active||o.step!==t)return!1;await k(e);const a=s();return a&&(a.step=e,a.active=!0,a.updatedAt=Date.now(),d(a)),!0}function j(t){const e=(t||"").toUpperCase(),o=new Set(["BR","PT"]),a=new Set(["CN"]),n=new Set(["US","GB","CA","AU","NZ","IE"]),i=new Set(["AR","BO","CL","CO","CR","CU","DO","EC","SV","GT","HN","MX","NI","PA","PY","PE","PR","UY","VE","ES"]);return o.has(e)?"pt":a.has(e)?"zh":n.has(e)?"en":i.has(e)?"es":"en"}function A(t){const e=`${O}${t.id}`;if(localStorage.getItem(e)==="1")return;if(!localStorage.getItem("appLanguage")){const a=j(t.country);P(a);try{B()}catch{}}localStorage.setItem(e,"1")}const m={es:{stepCreateSubjectTitle:"Paso 1: Creá tu primera asignatura",stepCreateSubjectBody:"Creá 1 asignatura para activar el tracking real de tu estudio.",createSubject:"Crear asignatura",stepCreateHabitTitle:"Paso 2: Creá un hábito",stepCreateHabitBody:"Ahora creá un hábito y revisá “Hábito clave”.",createHabit:"Crear hábito",goToHabits:"Ir a hábitos",stepConfigPomodoroTitle:"Paso 3: Configurá Pomodoro",stepConfigPomodoroBody:"Definí una materia por defecto para registrar bien tus sesiones.",goToDashboard:"Ir a dashboard",subjectCreatedToast:"¡Asignatura lista! Sigamos con hábitos.",habitCreatedToast:"¡Hábito creado! Configuramos Pomodoro."},en:{stepCreateSubjectTitle:"Step 1: Create your first subject",stepCreateSubjectBody:"Create 1 subject to enable real study tracking.",createSubject:"Create subject",stepCreateHabitTitle:"Step 2: Create a habit",stepCreateHabitBody:"Now create a habit and review “Key habit”.",createHabit:"Create habit",goToHabits:"Go to habits",stepConfigPomodoroTitle:"Step 3: Configure Pomodoro",stepConfigPomodoroBody:"Set a default subject to track sessions correctly.",goToDashboard:"Go to dashboard",subjectCreatedToast:"Subject created! Let's continue with habits.",habitCreatedToast:"Habit created! Let's configure Pomodoro."},pt:{stepCreateSubjectTitle:"Passo 1: Crie sua primeira disciplina",stepCreateSubjectBody:"Crie 1 disciplina para ativar o rastreamento real de estudo.",createSubject:"Criar disciplina",stepCreateHabitTitle:"Passo 2: Crie um hábito",stepCreateHabitBody:"Agora crie um hábito e revise “Hábito-chave”.",createHabit:"Criar hábito",goToHabits:"Ir para hábitos",stepConfigPomodoroTitle:"Passo 3: Configure o Pomodoro",stepConfigPomodoroBody:"Defina uma disciplina padrão para registrar sessões corretamente.",goToDashboard:"Ir para dashboard",subjectCreatedToast:"Disciplina criada! Vamos aos hábitos.",habitCreatedToast:"Hábito criado! Vamos configurar o Pomodoro."},zh:{stepCreateSubjectTitle:"步骤 1：创建你的第一门科目",stepCreateSubjectBody:"先创建 1 门科目，才能开始真实学习追踪。",createSubject:"创建科目",stepCreateHabitTitle:"步骤 2：创建一个习惯",stepCreateHabitBody:"现在创建一个习惯，并查看“关键习惯”。",createHabit:"创建习惯",goToHabits:"前往习惯",stepConfigPomodoroTitle:"步骤 3：配置番茄钟",stepConfigPomodoroBody:"设置默认科目，以便正确记录学习会话。",goToDashboard:"前往仪表盘",subjectCreatedToast:"科目创建成功！继续设置习惯。",habitCreatedToast:"习惯创建成功！继续配置番茄钟。"}};function r(t){const e=I();return m[e]?.[t]||m.en[t]||t}function s(){return H()}function D(t,e){const o=t.onboarding_step||"CREATE_SUBJECT";return t.onboarding_completed===!0||o==="DONE"||o==="SKIPPED"?!1:o==="CREATE_SUBJECT"?e===0:!0}function x(t,e){A(t);const o=t.onboarding_step||"CREATE_SUBJECT",a=D(t,e),n={active:a,step:o,hasSubjects:e>0,subjectsCount:e,updatedAt:Date.now(),userId:t.id};return d(n),a&&!sessionStorage.getItem(c)&&(sessionStorage.setItem(c,"1"),b("started",()=>l("onboarding_started",{step:o}),t.id)),n}async function R(){try{const t=await v(),e=await _("/subjects/"),o=Array.isArray(e)?e.length:t.subjects_count||0;return x(t,o)}catch{return s()}}async function k(t){const e=s();if(e?.step===t)return;await g({onboarding_step:t});const o={active:t!=="DONE"&&t!=="SKIPPED",step:t,hasSubjects:e?.hasSubjects??!1,subjectsCount:e?.subjectsCount??0,updatedAt:Date.now(),userId:e?.userId??0};d(o),b(`step_${t}`,()=>l("onboarding_step_completed",{step:t}),o.userId)}async function U(){await g({onboarding_step:"DONE",onboarding_completed:!0});const t=s();t&&(t.active=!1,t.step="DONE",t.updatedAt=Date.now(),d(t)),sessionStorage.removeItem(c),b("completed",()=>l("onboarding_completed",{step:"DONE"}),t?.userId)}async function T(){await g({onboarding_step:"SKIPPED"});const t=s()||{active:!1,step:"SKIPPED",hasSubjects:!1,subjectsCount:0,updatedAt:Date.now(),userId:0};t.active=!1,t.step="SKIPPED",t.updatedAt=Date.now(),d(t),sessionStorage.removeItem(c),b("skipped",()=>l("onboarding_skipped",{step:"SKIPPED"}),t.userId)}async function K(){await h("CREATE_SUBJECT","CREATE_HABIT")&&(f(r("subjectCreatedToast")),S({title:r("stepCreateHabitTitle"),body:r("stepCreateHabitBody"),primaryText:r("goToHabits"),primaryHref:"habits.html",lockClose:!1,allowSkip:!0,onSkip:async()=>{try{await T()}catch{}u()}}))}async function G(){await h("CREATE_HABIT","CONFIG_POMODORO")&&(f(r("habitCreatedToast")),S({title:r("stepConfigPomodoroTitle"),body:r("stepConfigPomodoroBody"),primaryText:r("goToDashboard"),primaryHref:"dashboard.html",lockClose:!1,allowSkip:!0,onSkip:async()=>{try{await T()}catch{}u()}}))}function $(t){window.addEventListener("storage",e=>{e.key===C&&t?.(s())})}function S(t){const{overlay:e,titleEl:o,bodyEl:a,primaryBtn:n,closeBtn:i,skipBtn:p}=y();e&&(o&&(o.textContent=t.title),a&&(a.textContent=t.body),n&&(n.textContent=t.primaryText,n.href=t.primaryHref||"#",n.classList.add("onboarding-cta-pulse"),n.onclick=E=>{t.primaryHref||E.preventDefault(),u(),t.onPrimary?.()}),i&&(i.style.display=t.lockClose?"none":"inline-flex",i.onclick=()=>u()),p&&(p.style.display=t.allowSkip?"inline-flex":"none",p.onclick=()=>t.onSkip?.()),e.classList.remove("hidden"),requestAnimationFrame(()=>e.classList.add("onboarding-visible")))}function u(){const{overlay:t}=y();t&&(t.classList.remove("onboarding-visible"),setTimeout(()=>t.classList.add("hidden"),160))}export{u as a,S as b,T as c,U as d,K as e,s as g,R as h,G as o,k as p,$ as s};
