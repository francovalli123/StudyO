(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();const G="http://127.0.0.1:8000/api";class A extends Error{constructor(o,t,a){super(o),this.name="ApiError",this.status=t,this.payload=a}}function B(){return localStorage.getItem("authToken")}function R(){localStorage.removeItem("authToken")}function F(e="application/json"){const o={"Content-Type":e},t=B();return t&&(o.Authorization=`Token ${t}`),o}function K(){try{const e=window.__studyoCaptureFocusState;if(typeof e=="function"){const o=e();o&&localStorage.setItem("studyo_focus_snapshot",JSON.stringify(o))}localStorage.setItem("studyo_auth_return_path",window.location.href)}catch{}try{window.dispatchEvent(new CustomEvent("auth:expired"))}catch{}}async function V(e){const o=async()=>{const t=`HTTP Error ${e.status}`,a=e.clone();try{const n=await a.json(),i=n?.detail||n?.message;return{message:typeof i=="string"?i:JSON.stringify(n),payload:n}}catch{try{return{message:await e.text()||t}}catch{return{message:t}}}};if(e.status===401||e.status===403){K(),R();const{message:t,payload:a}=await o();throw new A(t||"Session expired. Please login again.",e.status,a)}if(e.status===204)return null;if(!e.ok){const{message:t,payload:a}=await o();throw new A(t,e.status,a)}return e.json()}async function Y(e){const o=await fetch(`${G}${e}`,{method:"GET",headers:F(),credentials:"include"});return V(o)}async function J(){return Y("/user/me/")}const X=["/","/index.html","/login.html","/register.html","/forgot-password.html","/reset-password.html"],M={status:"checking",isAuthenticated:!1,token:null,user:null,authResolved:!1},Q=8e3,O=1,Z=1200;function ee(){const e=localStorage.getItem("appLanguage");return e==="en"?"Checking session...":e==="pt"?"Verificando sessão...":e==="zh"?"Checking session...":"Verificando sesión..."}function te(e,o,t){return new Promise((a,n)=>{const i=window.setTimeout(()=>n(new Error(t)),o);e.then(d=>{window.clearTimeout(i),a(d)}).catch(d=>{window.clearTimeout(i),n(d)})})}function oe(e){return new Promise(o=>window.setTimeout(o,e))}function ne(){const e=[document.documentElement,document.body].filter(t=>!!t),o=["zoom","transform","transform-origin"];e.forEach(t=>{o.forEach(a=>t.style.removeProperty(a)),t.style.setProperty("zoom","1"),t.style.setProperty("transform","none"),t.style.setProperty("transform-origin","0 0")})}function re(e){Object.assign(M,e),window.__studyoAuthState={...M};try{window.dispatchEvent(new CustomEvent("auth:state",{detail:window.__studyoAuthState}))}catch{}}function se(){if(document.getElementById("auth-loading"))return;const e=document.createElement("div");e.id="auth-loading",e.innerHTML=`
        <div class="auth-loading-spinner"></div>
        <div class="auth-loading-text">${ee()}</div>
    `,document.body.appendChild(e),document.documentElement.classList.add("auth-pending")}function ie(){document.documentElement.classList.remove("auth-pending"),document.getElementById("auth-loading")?.remove()}function q(){document.getElementById("auth-error")?.remove()}function ae(e,o){let t=document.getElementById("auth-error");t||(t=document.createElement("div"),t.id="auth-error",t.style.position="fixed",t.style.left="50%",t.style.bottom="24px",t.style.transform="translateX(-50%)",t.style.zIndex="10000",t.style.maxWidth="640px",t.style.width="calc(100% - 32px)",t.style.background="rgba(13,16,22,0.98)",t.style.border="1px solid rgba(168,85,247,0.45)",t.style.borderRadius="14px",t.style.padding="14px",t.style.boxShadow="0 8px 26px rgba(0,0,0,0.35)",t.style.color="#e5e7eb",t.innerHTML=`
            <div style="font-size:14px;font-weight:600;margin-bottom:8px">No se pudo validar tu sesiÃ³n.</div>
            <div id="auth-error-detail" style="font-size:13px;opacity:.9;margin-bottom:12px"></div>
            <div style="display:flex;gap:8px;justify-content:flex-end;flex-wrap:wrap">
                <button id="auth-retry-btn" type="button" style="background:#1f2937;color:#fff;border:1px solid #374151;border-radius:8px;padding:7px 12px;cursor:pointer">Reintentar</button>
                <button id="auth-login-btn" type="button" style="background:linear-gradient(90deg,#7c3aed,#d946ef);color:#fff;border:none;border-radius:8px;padding:7px 12px;cursor:pointer">Ir al login</button>
            </div>
        `,document.body.appendChild(t),t.querySelector("#auth-retry-btn")?.addEventListener("click",()=>{H({loginPath:e})}),t.querySelector("#auth-login-btn")?.addEventListener("click",()=>{const n=window.location.pathname;x(e,n)}));const a=t.querySelector("#auth-error-detail");a&&(a.textContent=o||"Revisa tu conexiÃ³n o intenta nuevamente.")}function W(e){return X.includes(e)}function _(){try{return B()}catch{return null}}function le(e){if(e instanceof A)return e.status;const o=e?.status??e?.response?.status;return typeof o=="number"?o:void 0}function D(e){const o=e?.message;return typeof o=="string"&&o.trim().length?o:"Error de conexiÃ³n"}function de(e,o){if(e===401||e===403)return!1;const t=D(o).toLowerCase();return t.includes("auth check timeout")||t.includes("network")||t.includes("failed to fetch")?!0:e===void 0||e>=500}function g(e,o){document.documentElement.classList.remove("auth-pending"),document.getElementById("auth-loading")?.remove(),e!=="error"&&q(),re({status:e,authResolved:e!=="checking",...o}),e==="checking"?se():ie()}function x(e,o){if(W(o)||o.endsWith(e))return;const t=encodeURIComponent(window.location.href);window.location.href=`${e}?next=${t}`}async function H(e){document.documentElement.classList.remove("auth-pending"),document.getElementById("auth-loading")?.remove(),q(),ne();const o=e?.loginPath??"login.html",t=window.location.pathname;if(W(t)){const d=_();g("public",{isAuthenticated:!!d,token:d,user:null});return}g("checking");const n=_();if(!n){g("unauthenticated",{isAuthenticated:!1,token:null,user:null}),x(o,t);return}let i=0;for(;i<=O;)try{const d=await te(J(),Q,"Auth check timeout");g("authenticated",{isAuthenticated:!0,token:n,user:d});return}catch(d){const v=le(d);if(v===401||v===403){R(),g("unauthenticated",{isAuthenticated:!1,token:null,user:null}),x(o,t);return}if(i<O&&de(v,d)){i+=1,await oe(Z*i);continue}g("error",{isAuthenticated:!1,token:n,user:null}),ae(o,D(d));return}}window.addEventListener("auth:expired",()=>{const e=window.location.pathname;g("unauthenticated",{isAuthenticated:!1,token:null,user:null}),x("login.html",e)});H({loginPath:"login.html"});(()=>{const e="is-mobile-sidebar-open",o="is-desktop-sidebar-collapsed",t=s=>{document.body.classList.toggle("no-scroll",s)},a=()=>{document.body.classList.remove("sidebar-collapsed",o);try{localStorage.setItem("sidebarCollapsed","0")}catch{}},n=()=>{try{return localStorage.getItem("sidebarCollapsed")==="1"}catch{return!1}},i=s=>{try{localStorage.setItem("sidebarCollapsed",s?"1":"0")}catch{}},d=(s,l=!0)=>{window.innerWidth<768||(document.body.classList.toggle(o,s),document.body.classList.remove("sidebar-collapsed"),l&&i(s))},v=()=>{window.innerWidth<768||d(n(),!1)};window.innerWidth<768&&a();const N=()=>{Array.from(document.querySelectorAll("header nav, body > nav, .top-nav, nav")).forEach((l,f)=>{const h=l.querySelector(".menu");if(!h)return;const L=l.querySelector(":scope > .btn-nav");if(l.classList.add("has-mobile-nav"),L&&!h.querySelector(".btn-nav-mobile")){const p=L.cloneNode(!0);p.classList.add("btn-nav-mobile"),p.removeAttribute("style"),h.appendChild(p)}if(l.querySelector(".mobile-menu-toggle"))return;const u=document.createElement("button");u.type="button",u.className="mobile-menu-toggle",u.setAttribute("aria-label","Abrir menu"),u.setAttribute("aria-expanded","false"),u.innerHTML="<span></span><span></span><span></span>",l.appendChild(u);let m=document.querySelector(`.mobile-menu-overlay[data-nav-overlay="${f}"]`);m||(m=document.createElement("div"),m.className="mobile-menu-overlay",m.dataset.navOverlay=String(f),document.body.appendChild(m));const y=()=>{l.classList.remove("mobile-open"),document.body.classList.remove("nav-open"),u.setAttribute("aria-expanded","false"),t(document.body.classList.contains(e))},w=()=>{document.querySelectorAll(".has-mobile-nav.mobile-open").forEach(p=>{p.classList.remove("mobile-open")}),l.classList.add("mobile-open"),document.body.classList.add("nav-open"),u.setAttribute("aria-expanded","true"),t(!0)};u.addEventListener("click",()=>{l.classList.contains("mobile-open")?y():w()}),m.addEventListener("click",y),h.querySelectorAll("a").forEach(p=>p.addEventListener("click",y)),window.addEventListener("resize",()=>{window.innerWidth>767&&l.classList.contains("mobile-open")&&y()})})},U=()=>{const s=document.getElementById("sidebar");if(!s)return;const l=document.getElementById("app-root"),f=document.querySelector("main"),h="#sidebarToggleBtn, [data-sidebar-toggle]",L=r=>{document.body.classList.toggle("planner-mobile-stack",r)},u=r=>{document.body.classList.toggle("subjects-mobile-header",r)},m=()=>document.body.classList.contains(e);document.body.classList.add("has-app-sidebar");let y=document.querySelector(".app-sidebar-overlay");y||(y=document.createElement("div"),y.className="app-sidebar-overlay",document.body.appendChild(y));const w=r=>{if(!(r instanceof HTMLElement))return!1;const c=window.getComputedStyle(r);return c.display!=="none"&&c.visibility!=="hidden"&&c.opacity!=="0"},p=()=>{const r=Array.from(document.querySelectorAll(".modal-overlay")).some(w),c=w(document.getElementById("objectiveModal")),b=w(document.getElementById("pomodoroSettingsModal")),P=w(document.getElementById("confirmModal")),I=r||c||b||P;document.body.classList.toggle("has-open-modal",I),t(I?!0:document.body.classList.contains("nav-open"))},S=()=>{const r=window.innerWidth<768,c=m();r?(a(),L(c),u(c)):(document.body.classList.remove(e),document.body.style.removeProperty("display"),document.body.style.removeProperty("min-height"),document.body.style.removeProperty("height"),document.body.style.removeProperty("overflow-y"),s.style.removeProperty("position"),s.style.removeProperty("top"),s.style.removeProperty("left"),s.style.removeProperty("bottom"),s.style.removeProperty("height"),s.style.removeProperty("width"),s.style.removeProperty("min-width"),s.style.removeProperty("max-width"),s.style.removeProperty("z-index"),s.style.removeProperty("overflow-y"),s.style.removeProperty("overflow-x"),s.style.removeProperty("transform"),s.style.removeProperty("transition"),l&&(l.style.removeProperty("width"),l.style.removeProperty("max-width"),l.style.removeProperty("margin-left"),l.style.removeProperty("min-width"),l.style.removeProperty("flex"),l.style.removeProperty("overflow"),l.style.removeProperty("overflow-x"),l.style.removeProperty("transition")),f&&(f.style.removeProperty("width"),f.style.removeProperty("max-width"),f.style.removeProperty("min-width"),f.style.removeProperty("overflow-x")),L(!1),u(!1))},E=()=>{document.body.classList.remove(e),S(),t(document.body.classList.contains("nav-open"))},k=()=>{document.body.classList.add(e),S(),t(document.body.classList.contains("nav-open"))},z=()=>{if(window.innerWidth<768)return;const r=document.body.classList.contains(o);d(!r)},j=()=>{window.innerWidth>=768||(m()?E():k())};y.addEventListener("click",E);const $=r=>{const c=r.target instanceof Element?r.target:null;!c||!c.closest(h)||(r.preventDefault(),r.stopPropagation(),r.stopImmediatePropagation(),window.innerWidth<768?j():z())};document.addEventListener("click",$,!0),document.addEventListener("pointerdown",r=>{if(window.innerWidth>=768||!m())return;const c=r.target instanceof Element?r.target:null;c&&(c.closest("#sidebar")||c.closest(h)||E())},!0),s.addEventListener("pointerdown",r=>{if(window.innerWidth>=768||m())return;const c=r.target instanceof Element?r.target:null;c&&(c.closest("a, button, [data-lucide], svg, i, input, select, textarea, label")||k())});const C=()=>{window.innerWidth>=768||a()},T=()=>{if(window.innerWidth<768)return;const r=document.body.classList.contains("sidebar-collapsed")||document.body.classList.contains(o);d(r)};new MutationObserver(r=>{for(const c of r)if(c.type==="attributes"){const b=document.body.classList,P=b.contains("sidebar-collapsed");P&&b.remove("sidebar-collapsed"),window.innerWidth>=768&&P&&!b.contains(o)&&(b.add(o),i(!0))}}).observe(document.body,{attributes:!0,attributeFilter:["class"]}),new MutationObserver(()=>{p()}).observe(document.body,{subtree:!0,attributes:!0,attributeFilter:["class","style"]}),document.addEventListener("click",()=>{window.setTimeout(p,0)},!0),s.querySelectorAll("a").forEach(r=>{r.addEventListener("click",()=>{window.innerWidth<768&&E()})}),window.addEventListener("resize",()=>{S(),C(),window.innerWidth>767?(E(),v(),T()):E()}),v(),S(),C(),T(),p()};document.addEventListener("DOMContentLoaded",()=>{N(),U()})})();console.log("StudyO frontend loaded.");
