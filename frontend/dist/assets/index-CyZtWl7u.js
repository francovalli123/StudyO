(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();var A=function(e,n,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function y(r){try{m(i.next(r))}catch(a){l(a)}}function u(r){try{m(i.throw(r))}catch(a){l(a)}}function m(r){r.done?s(r.value):o(r.value).then(y,u)}m((i=i.apply(e,n||[])).next())})};const F="http://127.0.0.1:8000/api";class C extends Error{constructor(n,t,i){super(n),this.name="ApiError",this.status=t,this.payload=i}}function W(){return localStorage.getItem("authToken")}function D(){localStorage.removeItem("authToken")}function K(e="application/json"){const n={"Content-Type":e},t=W();return t&&(n.Authorization=`Token ${t}`),n}function V(){try{const e=window.__studyoCaptureFocusState;if(typeof e=="function"){const n=e();n&&localStorage.setItem("studyo_focus_snapshot",JSON.stringify(n))}localStorage.setItem("studyo_auth_return_path",window.location.href)}catch{}try{window.dispatchEvent(new CustomEvent("auth:expired"))}catch{}}function Y(e){return A(this,void 0,void 0,function*(){const n=()=>A(this,void 0,void 0,function*(){const t=`HTTP Error ${e.status}`,i=e.clone();try{const o=yield i.json(),s=o?.detail||o?.message;return{message:typeof s=="string"?s:JSON.stringify(o),payload:o}}catch{try{return{message:(yield e.text())||t}}catch{return{message:t}}}});if(e.status===401||e.status===403){V(),D();const{message:t,payload:i}=yield n();throw new C(t||"Session expired. Please login again.",e.status,i)}if(e.status===204)return null;if(!e.ok){const{message:t,payload:i}=yield n();throw new C(t,e.status,i)}return e.json()})}function J(e){return A(this,void 0,void 0,function*(){const n=yield fetch(`${F}${e}`,{method:"GET",headers:K(),credentials:"include"});return Y(n)})}function X(){return A(this,void 0,void 0,function*(){return J("/user/me/")})}var Q=function(e,n,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function y(r){try{m(i.next(r))}catch(a){l(a)}}function u(r){try{m(i.throw(r))}catch(a){l(a)}}function m(r){r.done?s(r.value):o(r.value).then(y,u)}m((i=i.apply(e,n||[])).next())})};const Z=["/","/index.html","/login.html","/register.html","/forgot-password.html","/reset-password.html"],B={status:"checking",isAuthenticated:!1,token:null,user:null,authResolved:!1},ee=8e3,R=1,te=1200;function oe(){const e=localStorage.getItem("appLanguage");return e==="en"?"Checking session...":e==="pt"?"Verificando sessão...":e==="zh"?"Checking session...":"Verificando sesión..."}function ne(e,n,t){return new Promise((i,o)=>{const s=window.setTimeout(()=>o(new Error(t)),n);e.then(l=>{window.clearTimeout(s),i(l)}).catch(l=>{window.clearTimeout(s),o(l)})})}function re(e){return new Promise(n=>window.setTimeout(n,e))}function ie(){const e=[document.documentElement,document.body].filter(t=>!!t),n=["zoom","transform","transform-origin"];e.forEach(t=>{n.forEach(i=>t.style.removeProperty(i)),t.style.setProperty("zoom","1"),t.style.setProperty("transform","none"),t.style.setProperty("transform-origin","0 0")})}function se(e){Object.assign(B,e),window.__studyoAuthState=Object.assign({},B);try{window.dispatchEvent(new CustomEvent("auth:state",{detail:window.__studyoAuthState}))}catch{}}function ae(){if(document.getElementById("auth-loading"))return;const e=document.createElement("div");e.id="auth-loading",e.innerHTML=`
        <div class="auth-loading-spinner"></div>
        <div class="auth-loading-text">${oe()}</div>
    `,document.body.appendChild(e),document.documentElement.classList.add("auth-pending")}function de(){var e;document.documentElement.classList.remove("auth-pending"),(e=document.getElementById("auth-loading"))===null||e===void 0||e.remove()}function H(){var e;(e=document.getElementById("auth-error"))===null||e===void 0||e.remove()}function le(e,n){var t,i;let o=document.getElementById("auth-error");o||(o=document.createElement("div"),o.id="auth-error",o.style.position="fixed",o.style.left="50%",o.style.bottom="24px",o.style.transform="translateX(-50%)",o.style.zIndex="10000",o.style.maxWidth="640px",o.style.width="calc(100% - 32px)",o.style.background="rgba(13,16,22,0.98)",o.style.border="1px solid rgba(168,85,247,0.45)",o.style.borderRadius="14px",o.style.padding="14px",o.style.boxShadow="0 8px 26px rgba(0,0,0,0.35)",o.style.color="#e5e7eb",o.innerHTML=`
            <div style="font-size:14px;font-weight:600;margin-bottom:8px">No se pudo validar tu sesiÃ³n.</div>
            <div id="auth-error-detail" style="font-size:13px;opacity:.9;margin-bottom:12px"></div>
            <div style="display:flex;gap:8px;justify-content:flex-end;flex-wrap:wrap">
                <button id="auth-retry-btn" type="button" style="background:#1f2937;color:#fff;border:1px solid #374151;border-radius:8px;padding:7px 12px;cursor:pointer">Reintentar</button>
                <button id="auth-login-btn" type="button" style="background:linear-gradient(90deg,#7c3aed,#d946ef);color:#fff;border:none;border-radius:8px;padding:7px 12px;cursor:pointer">Ir al login</button>
            </div>
        `,document.body.appendChild(o),(t=o.querySelector("#auth-retry-btn"))===null||t===void 0||t.addEventListener("click",()=>{z({loginPath:e})}),(i=o.querySelector("#auth-login-btn"))===null||i===void 0||i.addEventListener("click",()=>{const l=window.location.pathname;k(e,l)}));const s=o.querySelector("#auth-error-detail");s&&(s.textContent=n||"Revisa tu conexiÃ³n o intenta nuevamente.")}function N(e){return Z.includes(e)}function q(){try{return W()}catch{return null}}function ce(e){var n,t;if(e instanceof C)return e.status;const i=(n=e?.status)!==null&&n!==void 0?n:(t=e?.response)===null||t===void 0?void 0:t.status;return typeof i=="number"?i:void 0}function U(e){const n=e?.message;return typeof n=="string"&&n.trim().length?n:"Error de conexiÃ³n"}function ue(e,n){if(e===401||e===403)return!1;const t=U(n).toLowerCase();return t.includes("auth check timeout")||t.includes("network")||t.includes("failed to fetch")?!0:e===void 0||e>=500}function E(e,n){var t;document.documentElement.classList.remove("auth-pending"),(t=document.getElementById("auth-loading"))===null||t===void 0||t.remove(),e!=="error"&&H(),se(Object.assign({status:e,authResolved:e!=="checking"},n)),e==="checking"?ae():de()}function k(e,n){if(N(n)||n.endsWith(e))return;const t=encodeURIComponent(window.location.href);window.location.href=`${e}?next=${t}`}function z(e){return Q(this,void 0,void 0,function*(){var n,t;document.documentElement.classList.remove("auth-pending"),(n=document.getElementById("auth-loading"))===null||n===void 0||n.remove(),H(),ie();const i=(t=e?.loginPath)!==null&&t!==void 0?t:"login.html",o=window.location.pathname;if(N(o)){const u=q();E("public",{isAuthenticated:!!u,token:u,user:null});return}E("checking");const l=q();if(!l){E("unauthenticated",{isAuthenticated:!1,token:null,user:null}),k(i,o);return}let y=0;for(;y<=R;)try{const u=yield ne(X(),ee,"Auth check timeout");E("authenticated",{isAuthenticated:!0,token:l,user:u});return}catch(u){const m=ce(u);if(m===401||m===403){D(),E("unauthenticated",{isAuthenticated:!1,token:null,user:null}),k(i,o);return}if(y<R&&ue(m,u)){y+=1,yield re(te*y);continue}E("error",{isAuthenticated:!1,token:l,user:null}),le(i,U(u));return}})}window.addEventListener("auth:expired",()=>{const e=window.location.pathname;E("unauthenticated",{isAuthenticated:!1,token:null,user:null}),k("login.html",e)});z({loginPath:"login.html"});(()=>{const e="is-mobile-sidebar-open",n="is-desktop-sidebar-collapsed",t=r=>{document.body.classList.toggle("no-scroll",r)},i=()=>{document.body.classList.remove("sidebar-collapsed",n);try{localStorage.setItem("sidebarCollapsed","0")}catch{}},o=()=>{try{return localStorage.getItem("sidebarCollapsed")==="1"}catch{return!1}},s=r=>{try{localStorage.setItem("sidebarCollapsed",r?"1":"0")}catch{}},l=(r,a=!0)=>{window.innerWidth<768||(document.body.classList.toggle(n,r),document.body.classList.remove("sidebar-collapsed"),a&&s(r))},y=()=>{window.innerWidth<768||l(o(),!1)};window.innerWidth<768&&i();const u=()=>{Array.from(document.querySelectorAll("header nav, body > nav, .top-nav, nav")).forEach((a,v)=>{const g=a.querySelector(".menu");if(!g)return;const x=a.querySelector(":scope > .btn-nav");if(a.classList.add("has-mobile-nav"),x&&!g.querySelector(".btn-nav-mobile")){const h=x.cloneNode(!0);h.classList.add("btn-nav-mobile"),h.removeAttribute("style"),g.appendChild(h)}if(a.querySelector(".mobile-menu-toggle"))return;const p=document.createElement("button");p.type="button",p.className="mobile-menu-toggle",p.setAttribute("aria-label","Abrir menu"),p.setAttribute("aria-expanded","false"),p.innerHTML="<span></span><span></span><span></span>",a.appendChild(p);let f=document.querySelector(`.mobile-menu-overlay[data-nav-overlay="${v}"]`);f||(f=document.createElement("div"),f.className="mobile-menu-overlay",f.dataset.navOverlay=String(v),document.body.appendChild(f));const b=()=>{a.classList.remove("mobile-open"),document.body.classList.remove("nav-open"),p.setAttribute("aria-expanded","false"),t(document.body.classList.contains(e))},L=()=>{document.querySelectorAll(".has-mobile-nav.mobile-open").forEach(h=>{h.classList.remove("mobile-open")}),a.classList.add("mobile-open"),document.body.classList.add("nav-open"),p.setAttribute("aria-expanded","true"),t(!0)};p.addEventListener("click",()=>{a.classList.contains("mobile-open")?b():L()}),f.addEventListener("click",b),g.querySelectorAll("a").forEach(h=>h.addEventListener("click",b)),window.addEventListener("resize",()=>{window.innerWidth>767&&a.classList.contains("mobile-open")&&b()})})},m=()=>{const r=document.getElementById("sidebar");if(!r)return;const a=document.getElementById("app-root"),v=document.querySelector("main"),g="#sidebarToggleBtn, [data-sidebar-toggle]",x=d=>{document.body.classList.toggle("planner-mobile-stack",d)},p=d=>{document.body.classList.toggle("subjects-mobile-header",d)},f=()=>document.body.classList.contains(e);document.body.classList.add("has-app-sidebar");let b=document.querySelector(".app-sidebar-overlay");b||(b=document.createElement("div"),b.className="app-sidebar-overlay",document.body.appendChild(b));const L=d=>{if(!(d instanceof HTMLElement))return!1;const c=window.getComputedStyle(d);return c.display!=="none"&&c.visibility!=="hidden"&&c.opacity!=="0"},h=()=>{const d=Array.from(document.querySelectorAll(".modal-overlay")).some(L),c=L(document.getElementById("objectiveModal")),w=L(document.getElementById("pomodoroSettingsModal")),_=L(document.getElementById("confirmModal")),O=d||c||w||_;document.body.classList.toggle("has-open-modal",O),t(O?!0:document.body.classList.contains("nav-open"))},P=()=>{const d=window.innerWidth<768,c=f();d?(i(),x(c),p(c)):(document.body.classList.remove(e),document.body.style.removeProperty("display"),document.body.style.removeProperty("min-height"),document.body.style.removeProperty("height"),document.body.style.removeProperty("overflow-y"),r.style.removeProperty("position"),r.style.removeProperty("top"),r.style.removeProperty("left"),r.style.removeProperty("bottom"),r.style.removeProperty("height"),r.style.removeProperty("width"),r.style.removeProperty("min-width"),r.style.removeProperty("max-width"),r.style.removeProperty("z-index"),r.style.removeProperty("overflow-y"),r.style.removeProperty("overflow-x"),r.style.removeProperty("transform"),r.style.removeProperty("transition"),a&&(a.style.removeProperty("width"),a.style.removeProperty("max-width"),a.style.removeProperty("margin-left"),a.style.removeProperty("min-width"),a.style.removeProperty("flex"),a.style.removeProperty("overflow"),a.style.removeProperty("overflow-x"),a.style.removeProperty("transition")),v&&(v.style.removeProperty("width"),v.style.removeProperty("max-width"),v.style.removeProperty("min-width"),v.style.removeProperty("overflow-x")),x(!1),p(!1))},S=()=>{document.body.classList.remove(e),P(),t(document.body.classList.contains("nav-open"))},T=()=>{document.body.classList.add(e),P(),t(document.body.classList.contains("nav-open"))},j=()=>{if(window.innerWidth<768)return;const d=document.body.classList.contains(n);l(!d)},$=()=>{window.innerWidth>=768||(f()?S():T())};b.addEventListener("click",S);const G=d=>{const c=d.target instanceof Element?d.target:null;!c||!c.closest(g)||(d.preventDefault(),d.stopPropagation(),d.stopImmediatePropagation(),window.innerWidth<768?$():j())};document.addEventListener("click",G,!0),document.addEventListener("pointerdown",d=>{if(window.innerWidth>=768||!f())return;const c=d.target instanceof Element?d.target:null;c&&(c.closest("#sidebar")||c.closest(g)||S())},!0),r.addEventListener("pointerdown",d=>{if(window.innerWidth>=768||f())return;const c=d.target instanceof Element?d.target:null;c&&(c.closest("a, button, [data-lucide], svg, i, input, select, textarea, label")||T())});const I=()=>{window.innerWidth>=768||i()},M=()=>{if(window.innerWidth<768)return;const d=document.body.classList.contains("sidebar-collapsed")||document.body.classList.contains(n);l(d)};new MutationObserver(d=>{for(const c of d)if(c.type==="attributes"){const w=document.body.classList,_=w.contains("sidebar-collapsed");_&&w.remove("sidebar-collapsed"),window.innerWidth>=768&&_&&!w.contains(n)&&(w.add(n),s(!0))}}).observe(document.body,{attributes:!0,attributeFilter:["class"]}),new MutationObserver(()=>{h()}).observe(document.body,{subtree:!0,attributes:!0,attributeFilter:["class","style"]}),document.addEventListener("click",()=>{window.setTimeout(h,0)},!0),r.querySelectorAll("a").forEach(d=>{d.addEventListener("click",()=>{window.innerWidth<768&&S()})}),window.addEventListener("resize",()=>{P(),I(),window.innerWidth>767?(S(),y(),M()):S()}),y(),P(),I(),M(),h()};document.addEventListener("DOMContentLoaded",()=>{u(),m()})})();console.log("StudyO frontend loaded.");
