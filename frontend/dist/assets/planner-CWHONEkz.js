import"./modulepreload-polyfill-B5Qt9EMX.js";import{g as J,a as K,i as Q,e as V,b as X,k as Z,m as ee,n as te}from"./auth-gate-B8HnkSQA.js";import{i as ne,a as A,s as oe}from"./confirmModal-L4nKbxRN.js";import{g as S,b as x}from"./responsive-DwadFwRg.js";document.addEventListener("DOMContentLoaded",async function(){try{await J()}catch(e){console.error("Error al cargar información del usuario:",e),(e.message==="No autenticado"||e.message==="Sesión expirada")&&(window.location.href="/login")}const t=document.getElementById("logoutBtn");t&&t.addEventListener("click",async e=>{e.preventDefault();try{await K(),window.location.href="/"}catch(n){console.error("Error al cerrar sesión:",n),window.location.href="/"}})});Q({loginPath:"/login"});let H=[],O=[],u=new Date,h=null,R=null;async function ae(){ne(),await j(),await se(),I(),M(),de(),typeof lucide<"u"&&lucide.createIcons()}async function j(){try{H=await V(),I(),M()}catch(t){console.error("Error loading events:",t)}}async function se(){try{O=await X("/subjects/"),q()}catch(t){console.error("Error loading subjects:",t)}}function q(){const t=document.getElementById("eventSubject");if(t){for(;t.options.length>1;)t.remove(1);O.forEach(e=>{const n=document.createElement("option");n.value=e.id.toString(),n.textContent=e.name,t.appendChild(n)})}}function I(){const t=S(),e=t==="en"?"en-US":t==="pt"?"pt-BR":t==="zh"?"zh-CN":"es-AR",n=document.getElementById("calendarGrid"),l=document.getElementById("currentMonthYear");if(!n||!l)return;l.textContent=new Intl.DateTimeFormat(e,{month:"long",year:"numeric"}).format(u);const m=new Date(u.getFullYear(),u.getMonth(),1),d=new Date(u.getFullYear(),u.getMonth()+1,0).getDate(),g=(m.getDay()+6)%7,s=W(u);n.innerHTML="";for(let o=0;o<g;o++){const i=document.createElement("div");i.className="h-8",n.appendChild(i)}for(let o=1;o<=d;o++){const i=document.createElement("div"),y=new Date(u.getFullYear(),u.getMonth(),o),p=re(y,s),a=z(y).length>0;i.className=`calendar-day h-8 border border-gray-800 rounded flex items-center justify-center cursor-pointer transition-all relative ${_(y)?"bg-purple-500/20 border-purple-500/50":""} ${p?"ring-2 ring-purple-500/50":""} hover:border-purple-500/50 hover:bg-purple-500/10`,i.innerHTML=`
            <span class="text-xs font-medium ${_(y)?"text-purple-400":p?"text-white font-bold":"text-gray-300"}">${o}</span>
            ${a?'<span class="absolute bottom-0.5 left-1/2 transform -translate-x-1/2 w-1 h-1 rounded-full bg-purple-400"></span>':""}
        `,i.addEventListener("click",()=>{u=new Date(y),I(),M()}),n.appendChild(i)}const r=42-(g+d);for(let o=0;o<r&&o<7;o++){const i=document.createElement("div");i.className="h-8",n.appendChild(i)}typeof lucide<"u"&&lucide.createIcons()}function re(t,e){const n=new Date(e);n.setDate(e.getDate()+6),n.setHours(23,59,59,999);const l=new Date(t);l.setHours(0,0,0,0);const m=new Date(e);return m.setHours(0,0,0,0),l>=m&&l<=n}function M(){const t=S(),e=x[t],n=t==="en"?"en-US":t==="pt"?"pt-BR":t==="zh"?"zh-CN":"es-AR",l=document.getElementById("weeklySchedule"),m=document.getElementById("weekRange"),f=document.getElementById("weekNumber");if(!l||!m)return;const d=W(u);if(new Date(d).setDate(d.getDate()+6),m.textContent=new Intl.DateTimeFormat(n,{month:"long",year:"numeric"}).format(d),f){const s=ie(d);f.textContent=(e.planner.weekNumberLabel||"Semana {n}").replace("{n}",String(s))}for(let s=0;s<7;s++){const c=new Date(d);c.setDate(d.getDate()+s);const r=document.getElementById(`day-${s}-date`);r&&(r.textContent=c.getDate().toString(),_(c)?r.classList.add("text-purple-400"):r.classList.remove("text-purple-400"))}l.innerHTML="";for(let s=0;s<24;s++){const c=document.createElement("div");c.className="grid grid-cols-8 gap-2";const r=document.createElement("div");r.className="text-xs text-gray-500 text-right pr-2 flex items-center justify-end h-12",r.textContent=`${String(s).padStart(2,"0")}:00`,c.appendChild(r);for(let o=0;o<7;o++){const i=new Date(d);i.setDate(d.getDate()+o),i.setHours(s,0,0,0);const y=document.createElement("div");y.className="h-12 border border-gray-800 rounded relative hover:border-purple-500/50 cursor-pointer group bg-dark-card",y.dataset.date=Y(i),y.dataset.hour=s.toString();const w=z(i).filter(a=>{const k=parseInt(a.start_time.split(":")[0]),B=parseInt(a.start_time.split(":")[1]),v=parseInt(a.end_time.split(":")[0]),C=parseInt(a.end_time.split(":")[1]),$=k*60+B,N=v*60+C,L=s*60,F=(s+1)*60;return $<F&&N>L});if(w.length>0)w.forEach(a=>{const k=parseInt(a.start_time.split(":")[0]),B=parseInt(a.start_time.split(":")[1]),v=parseInt(a.end_time.split(":")[0]),C=parseInt(a.end_time.split(":")[1]),$=k*60+B,N=v*60+C,L=k===s,F=v===s||v===s+1&&C===0;let b=0,D=48;L&&F?(b=B/60*48,D=(N-$)/60*48):L?(b=B/60*48,D=48-b):F?(b=0,D=C/60*48):(b=0,D=48),D=Math.max(D,24);const E=document.createElement("div");E.className=`event-item ${le(a.type)} text-xs p-1.5 rounded absolute left-0 right-0 z-10 cursor-pointer overflow-hidden flex items-center`,E.style.height=`${D}px`,E.style.top=`${b}px`,E.style.minHeight=`${D}px`,E.textContent=a.title,E.title=`${a.title} - ${a.start_time.substring(0,5)} - ${a.end_time.substring(0,5)}`,E.dataset.eventId=a.id?.toString()||"",E.addEventListener("click",P=>{P.stopPropagation(),a.id&&ce(a.id)}),y.appendChild(E)});else{const a=document.createElement("div");a.className="add-event-btn absolute inset-0 flex items-center justify-center text-gray-600 group-hover:text-purple-400 opacity-0 group-hover:opacity-100 transition-all",a.innerHTML='<i data-lucide="plus" class="w-4 h-4"></i>',y.appendChild(a)}y.addEventListener("click",a=>{a.target.closest(".event-item")||(R=i,G(i,s))}),c.appendChild(y)}l.appendChild(c)}typeof lucide<"u"&&lucide.createIcons()}function z(t){const e=Y(t);return H.filter(n=>n.date===e)}function le(t){switch(t){case 1:return"";case 2:return"exam";case 3:return"task";case 4:return"personal";default:return""}}function _(t){const e=new Date;return t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()}function W(t){const e=new Date(t),n=e.getDay(),l=e.getDate()-n+(n===0?-6:1);return new Date(e.setDate(l))}function ie(t){const e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),n=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-n);const l=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e.getTime()-l.getTime())/864e5+1)/7)}function Y(t){const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${l}`}function U(t){return t.substring(0,5)}function G(t,e){const n=document.getElementById("eventModal"),l=document.getElementById("eventForm"),m=document.getElementById("modalTitle"),f=S(),d=x[f].planner;if(!n||!l)return;l.reset(),h=null,q();const g=t||R||new Date,s=document.getElementById("eventDate"),c=document.getElementById("eventStartTime"),r=document.getElementById("eventEndTime");s&&(s.value=Y(g)),c&&e!==void 0?c.value=`${String(e).padStart(2,"0")}:00`:c&&(c.value="00:00"),r&&e!==void 0?r.value=`${String(e+1).padStart(2,"0")}:00`:r&&(r.value="01:00"),m&&(m.textContent=d.newEvent);const o=document.getElementById("deleteEventBtn");if(o&&(o.style.display="none"),n.style.display="flex",typeof lucide<"u"){lucide.createIcons();const i=()=>{n.querySelectorAll("[data-lucide]").forEach(p=>{const w=p;w.style.filter="none",w.style.textShadow="none",w.style.boxShadow="none",w.style.webkitFilter="none";const a=p.querySelector("svg");a&&(a.style.filter="none",a.style.textShadow="none",a.style.boxShadow="none",a.style.webkitFilter="none",a.querySelectorAll("path").forEach(B=>{const v=B;v.style&&(v.style.filter="none",v.style.webkitFilter="none")}))})};i(),setTimeout(i,50),setTimeout(i,100),setTimeout(i,200)}}function T(){const t=document.getElementById("eventModal");if(t){t.style.display="none";const e=document.getElementById("eventForm");e&&e.reset(),h=null;const n=document.getElementById("deleteEventBtn");n&&(n.style.display="none")}}function ce(t){const e=H.find(g=>g.id===t);if(!e)return;h=e;const n=document.getElementById("eventModal"),l=document.getElementById("modalTitle"),m=document.getElementById("eventForm"),f=x[S()].planner;if(!n||!m||!l)return;document.getElementById("eventTitle").value=e.title,document.getElementById("eventDate").value=e.date,document.getElementById("eventType").value=e.type.toString(),document.getElementById("eventStartTime").value=U(e.start_time),document.getElementById("eventEndTime").value=U(e.end_time),document.getElementById("eventSubject").value=e.subject?.toString()||"",document.getElementById("eventNotes").value=e.notes||"",l.textContent=f.editEvent;const d=document.getElementById("deleteEventBtn");if(d&&(d.style.display="block"),n.style.display="flex",typeof lucide<"u"){lucide.createIcons();const g=()=>{n.querySelectorAll("[data-lucide]").forEach(c=>{const r=c;r.style.filter="none",r.style.textShadow="none",r.style.boxShadow="none",r.style.webkitFilter="none";const o=c.querySelector("svg");o&&(o.style.filter="none",o.style.textShadow="none",o.style.boxShadow="none",o.style.webkitFilter="none",o.querySelectorAll("path").forEach(y=>{const p=y;p.style&&(p.style.filter="none",p.style.webkitFilter="none")}))})};g(),setTimeout(g,50),setTimeout(g,100),setTimeout(g,200)}}function de(){const t=document.getElementById("prevMonthBtn"),e=document.getElementById("nextMonthBtn");t&&t.addEventListener("click",()=>{u.setMonth(u.getMonth()-1),I()}),e&&e.addEventListener("click",()=>{u.setMonth(u.getMonth()+1),I()});const n=document.getElementById("prevWeekBtn"),l=document.getElementById("nextWeekBtn"),m=document.getElementById("todayBtn");n&&n.addEventListener("click",()=>{u.setDate(u.getDate()-7),I(),M()}),l&&l.addEventListener("click",()=>{u.setDate(u.getDate()+7),I(),M()}),m&&m.addEventListener("click",()=>{u=new Date,I(),M()});const f=document.getElementById("addEventBtn");f&&f.addEventListener("click",()=>{const o=W(u);G(o)});const d=document.getElementById("closeEventModalBtn"),g=document.getElementById("cancelEventBtn"),s=document.getElementById("deleteEventBtn");d&&d.addEventListener("click",T),g&&g.addEventListener("click",T),s&&s.addEventListener("click",async()=>{if(h&&h.id){const o=x[S()];await oe(o.confirmations.deleteEventMessage,o.confirmations.deleteEventTitle)&&await ue(h.id)}});const c=document.getElementById("eventForm");c&&c.addEventListener("submit",async o=>{o.preventDefault(),await me()});const r=document.getElementById("eventModal");r&&r.addEventListener("click",o=>{o.target===r&&T()})}async function ue(t){try{await te(t),T(),await j()}catch(e){console.error("Error deleting event:",e);const n=x[S()];await A(n.confirmations.deleteEventMessage,n.common.error)}}async function me(){const t=document.getElementById("eventForm");if(!t)return;const e=x[S()],n=new FormData(t),l=n.get("title"),m=n.get("date"),f=parseInt(n.get("type")),d=n.get("start_time"),g=n.get("end_time"),s=n.get("subject")||null,c=n.get("notes")||null;try{const r={title:l,date:m,type:f,start_time:d,end_time:g,subject:s&&s!==""?parseInt(s):null,notes:c};h&&h.id?await Z(h.id,r):await ee(r),T(),await j()}catch(r){console.error("Error saving event:",r),await A(e.common.error,e.common.error)}}document.addEventListener("DOMContentLoaded",ae);
